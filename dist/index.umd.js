(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports):typeof define==="function"&&define.amd?define(["exports"],t):(e=typeof globalThis!=="undefined"?globalThis:e||self,t(e.YStorage={}))})(this,(function(e){"use strict";function t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function r(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?t(Object(i),!0).forEach((function(t){a(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function a(e,t,r){t=o(t);if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function i(e,t){if(typeof e!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==undefined){var a=r.call(e,t||"default");if(typeof a!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function o(e){var t=i(e,"string");return typeof t==="symbol"?t:String(t)}function s(e){var t;var r=(t=window)===null||t===void 0?void 0:t[(e||"local")+"Storage"];if(r===undefined){throw new Error("[YStorage] The current environment does not support ".concat(e,"Storage"))}return r}class n{constructor(e){var t,r;a(this,"prefix","YStorage_");a(this,"namespace",void 0);a(this,"storageKey",void 0);a(this,"target",void 0);a(this,"callback",void 0);this.target=(t=e.target)!==null&&t!==void 0?t:"local";this.namespace=e.namespace;this.storageKey=this.prefix+e.namespace;e.override=(r=e.override)!==null&&r!==void 0?r:false;if(e.callback){this.callback=e.callback}this._initSpace(e)}_initSpace(e){try{var t=s(this.target);if(!t.getItem(this.storageKey)||e.override===true){t.setItem(this.storageKey,JSON.stringify({}))}this.callback&&this.callback({func:"init",namespace:this.namespace,target:this.target})}catch(e){throw new Error("[YStorage] Initialization failed ".concat(e===null||e===void 0?void 0:e.message))}}has(e){try{var t=s(this.target);var r=t.getItem(this.storageKey)||"";var a=r?JSON.parse(r):{};return Object.hasOwn(a,e)}catch(e){throw new Error("[YStorage] read fail ".concat(e===null||e===void 0?void 0:e.message))}}destroy(){try{var e=s(this.target);e.removeItem(this.storageKey);this.callback&&this.callback({func:"destroy",namespace:this.namespace,target:this.target})}catch(e){throw new Error("[YStorage] destroy fail ".concat(e===null||e===void 0?void 0:e.message))}}setItem(e,t,a){try{var i,o,n;var c=s(this.target);var l={expires:(i=a===null||a===void 0?void 0:a.expires)!==null&&i!==void 0?i:0,once:(o=a===null||a===void 0?void 0:a.once)!==null&&o!==void 0?o:false,override:(n=a===null||a===void 0?void 0:a.override)!==null&&n!==void 0?n:true};var v=c.getItem(this.storageKey)||"";var g=v?JSON.parse(v):{};if(g[e]&&!l.override){throw new Error("[YStorage] The key ".concat(e," already exists"))}g[e]={value:t!==null&&t!==void 0?t:"",expires:l.expires!==0?(new Date).getTime()+l.expires:0,once:l.once,override:l.override};c.setItem(this.storageKey,JSON.stringify(g));this.callback&&this.callback(r({func:"setItem",namespace:this.namespace,target:this.target,key:e,value:t},l))}catch(e){throw new Error("[YStorage] setItem failed ".concat(e===null||e===void 0?void 0:e.message))}}removeItem(e){try{var t=s(this.target);var r=t.getItem(this.storageKey)||"";var a=r?JSON.parse(r):{};delete a[e];t===null||t===void 0?void 0:t.setItem(this.storageKey,JSON.stringify(a));this.callback&&this.callback({func:"removeItem",target:this.target,namespace:this.namespace,key:e})}catch(e){throw new Error("[YStorage] removeItem failed ".concat(e===null||e===void 0?void 0:e.message))}}getItem(e){try{var t=s(this.target);var r=null;var a=t.getItem(this.storageKey)||"";var i=a?JSON.parse(a):{};var o=i[e];if(o){if(o.expires&&o.expires<(new Date).getTime()){this.removeItem(e)}else{r=o.value}if(o.once){this.removeItem(e)}}this.callback&&this.callback({func:"getItem",target:this.target,namespace:this.namespace,key:e,value:r});return r}catch(e){throw new Error("[YStorage] getItem failed ".concat(e===null||e===void 0?void 0:e.message))}}clear(){try{var e=s(this.target);e.setItem(this.storageKey,JSON.stringify({}));this.callback&&this.callback({func:"clear",target:this.target,namespace:this.namespace})}catch(e){throw new Error("[YStorage] clear failed ".concat(e===null||e===void 0?void 0:e.message))}}}e.YStorage=n}));
