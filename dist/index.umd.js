(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?t(exports):typeof define==="function"&&define.amd?define(["exports"],t):(e=typeof globalThis!=="undefined"?globalThis:e||self,t(e.YStorage={}))})(this,(function(e){"use strict";function t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function r(e){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?t(Object(i),!0).forEach((function(t){a(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function a(e,t,r){t=o(t);if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function i(e,t){if(typeof e!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==undefined){var a=r.call(e,t||"default");if(typeof a!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function o(e){var t=i(e,"string");return typeof t==="symbol"?t:String(t)}function s(e){var t;var r=(t=window)===null||t===void 0?void 0:t[(e||"local")+"Storage"];if(r===undefined){throw new Error("[YStorage] The current environment does not support ".concat(e,"Storage"))}return r}class n{constructor(e){var t,r;a(this,"prefix","YStorage_");a(this,"namespace",void 0);a(this,"target",void 0);a(this,"storage",void 0);a(this,"callback",void 0);this.target=(t=e.target)!==null&&t!==void 0?t:"local";this.storage=s(this.target);this.namespace=this.prefix+e.namespace;e.override=(r=e.override)!==null&&r!==void 0?r:false;if(e.callback){this.callback=e.callback}this._initSpace(e)}_initSpace(e){try{if(!this.storage.getItem(this.namespace)||e.override===true){this.storage.setItem(this.namespace,JSON.stringify({}))}this.callback&&this.callback({func:"init",namespace:this.namespace,target:this.target})}catch(e){throw new Error("[YStorage] Initialization failed ".concat(e===null||e===void 0?void 0:e.message))}}has(e){try{var t=this.storage.getItem(this.namespace)||"";var r=t?JSON.parse(t):{};return Object.hasOwn(r,e)}catch(e){throw new Error("[YStorage] read fail ".concat(e===null||e===void 0?void 0:e.message))}}destroy(){try{this.storage.removeItem(this.namespace);this.callback&&this.callback({func:"destroy",namespace:this.namespace,target:this.target})}catch(e){throw new Error("[YStorage] destroy fail ".concat(e===null||e===void 0?void 0:e.message))}}setItem(e,t,a){try{var i,o,s;var n={expires:(i=a===null||a===void 0?void 0:a.expires)!==null&&i!==void 0?i:0,once:(o=a===null||a===void 0?void 0:a.once)!==null&&o!==void 0?o:false,override:(s=a===null||a===void 0?void 0:a.override)!==null&&s!==void 0?s:false};var c=this.storage.getItem(this.namespace)||"";var l=c?JSON.parse(c):{};if(l[e]&&!n.override){throw new Error("[YStorage] The key ".concat(e," already exists"))}l[e]={value:t!==null&&t!==void 0?t:"",expires:n.expires!==0?(new Date).getTime()+n.expires:0,once:n.once,override:n.override};this.storage.setItem(this.namespace,JSON.stringify(l));this.callback&&this.callback(r({func:"setItem",namespace:this.namespace,target:this.target,key:e,value:t},n))}catch(e){throw new Error("[YStorage] setItem failed ".concat(e===null||e===void 0?void 0:e.message))}}removeItem(e){try{var t;var r=this.storage.getItem(this.namespace)||"";var a=r?JSON.parse(r):{};delete a[e];(t=this.storage)===null||t===void 0?void 0:t.setItem(this.namespace,JSON.stringify(a));this.callback&&this.callback({func:"removeItem",target:this.target,namespace:this.namespace,key:e})}catch(e){throw new Error("[YStorage] removeItem failed ".concat(e===null||e===void 0?void 0:e.message))}}getItem(e){try{var t=null;var r=this.storage.getItem(this.namespace)||"";var a=r?JSON.parse(r):{};var i=a[e];if(i){if(i.expires&&i.expires<(new Date).getTime()){this.removeItem(e)}else{t=JSON.parse(typeof i.value==="string"?i.value:"")}if(i.once){this.removeItem(e)}}this.callback&&this.callback({func:"getItem",target:this.target,namespace:this.namespace,key:e,value:t});return t}catch(e){throw new Error("[YStorage] getItem failed ".concat(e===null||e===void 0?void 0:e.message))}}clear(){try{this.storage.setItem(this.namespace,"");this.callback&&this.callback({func:"clear",target:this.target,namespace:this.namespace})}catch(e){throw new Error("[YStorage] clear failed ".concat(e===null||e===void 0?void 0:e.message))}}}e.YStorage=n}));
