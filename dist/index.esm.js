function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function t(t){for(var a=1;a<arguments.length;a++){var i=null!=arguments[a]?arguments[a]:{};a%2?e(Object(i),!0).forEach((function(e){r(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function r(e,t,r){t=i(t);if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function a(e,t){if(typeof e!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==undefined){var a=r.call(e,t||"default");if(typeof a!=="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function i(e){var t=a(e,"string");return typeof t==="symbol"?t:String(t)}function o(e){var t;var r=(t=window)===null||t===void 0?void 0:t[(e||"local")+"Storage"];if(r===undefined){throw new Error("[YStorage] The current environment does not support ".concat(e,"Storage"))}return r}class s{constructor(e){var t,a;r(this,"prefix","YStorage_");r(this,"namespace",void 0);r(this,"storageKey",void 0);r(this,"target",void 0);r(this,"callback",void 0);this.target=(t=e.target)!==null&&t!==void 0?t:"local";this.namespace=e.namespace;this.storageKey=this.prefix+e.namespace;e.override=(a=e.override)!==null&&a!==void 0?a:false;if(e.callback){this.callback=e.callback}this._initSpace(e)}_initSpace(e){try{var t=o(this.target);if(!t.getItem(this.storageKey)||e.override===true){t.setItem(this.storageKey,JSON.stringify({}))}this.callback&&this.callback({func:"init",namespace:this.namespace,target:this.target})}catch(e){throw new Error("[YStorage] Initialization failed ".concat(e===null||e===void 0?void 0:e.message))}}has(e){try{var t=o(this.target);var r=t.getItem(this.storageKey)||"";var a=r?JSON.parse(r):{};return Object.hasOwn(a,e)}catch(e){throw new Error("[YStorage] read fail ".concat(e===null||e===void 0?void 0:e.message))}}destroy(){try{var e=o(this.target);e.removeItem(this.storageKey);this.callback&&this.callback({func:"destroy",namespace:this.namespace,target:this.target})}catch(e){throw new Error("[YStorage] destroy fail ".concat(e===null||e===void 0?void 0:e.message))}}setItem(e,r,a){try{var i,s,n;var c=o(this.target);var l={expires:(i=a===null||a===void 0?void 0:a.expires)!==null&&i!==void 0?i:0,once:(s=a===null||a===void 0?void 0:a.once)!==null&&s!==void 0?s:false,override:(n=a===null||a===void 0?void 0:a.override)!==null&&n!==void 0?n:true};var v=c.getItem(this.storageKey)||"";var g=v?JSON.parse(v):{};if(g[e]&&!l.override){throw new Error("[YStorage] The key ".concat(e," already exists"))}g[e]={value:r!==null&&r!==void 0?r:"",expires:l.expires!==0?(new Date).getTime()+l.expires:0,once:l.once,override:l.override};c.setItem(this.storageKey,JSON.stringify(g));this.callback&&this.callback(t({func:"setItem",namespace:this.namespace,target:this.target,key:e,value:r},l))}catch(e){throw new Error("[YStorage] setItem failed ".concat(e===null||e===void 0?void 0:e.message))}}removeItem(e){try{var t=o(this.target);var r=t.getItem(this.storageKey)||"";var a=r?JSON.parse(r):{};delete a[e];t===null||t===void 0?void 0:t.setItem(this.storageKey,JSON.stringify(a));this.callback&&this.callback({func:"removeItem",target:this.target,namespace:this.namespace,key:e})}catch(e){throw new Error("[YStorage] removeItem failed ".concat(e===null||e===void 0?void 0:e.message))}}getItem(e){try{var t=o(this.target);var r=null;var a=t.getItem(this.storageKey)||"";var i=a?JSON.parse(a):{};var s=i[e];if(s){if(s.expires&&s.expires<(new Date).getTime()){this.removeItem(e)}else{r=s.value}if(s.once){this.removeItem(e)}}this.callback&&this.callback({func:"getItem",target:this.target,namespace:this.namespace,key:e,value:r});return r}catch(e){throw new Error("[YStorage] getItem failed ".concat(e===null||e===void 0?void 0:e.message))}}clear(){try{var e=o(this.target);e.setItem(this.storageKey,JSON.stringify({}));this.callback&&this.callback({func:"clear",target:this.target,namespace:this.namespace})}catch(e){throw new Error("[YStorage] clear failed ".concat(e===null||e===void 0?void 0:e.message))}}}export{s as YStorage};
